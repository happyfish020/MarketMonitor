A è‚¡ç³»ç»Ÿæ•°æ®æµæ–‡æ¡£ï¼ˆSnapshot â†’ å› å­ â†’ é¢„æµ‹ â†’ æŠ¥å‘Šï¼‰
-----------------------------------------
ğŸ¯ æ€»è§ˆ

ç»Ÿä¸€é£é™©ç³»ç»Ÿï¼ˆUnifiedRisk CNï¼‰æ¯æ—¥è¿è¡Œçš„å®Œæ•´æµç¨‹å¦‚ä¸‹ï¼š

                â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
                â”‚ Remote Datasourceâ”‚
                â”‚ (YF/ä¸œè´¢/æ–°æµªç­‰) â”‚
                â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
               â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
               â”‚  AShareFetcher      â”‚
               â”‚  get_daily_snapshot â”‚
               â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
          Snapshot(JSON)ï¼šetf_proxy / turnover / margin / index_series / global_lead / breadth
                          â”‚
                          â–¼
         â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
         â”‚ _build_processed_for_factors() â”‚
         â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
                processed dictï¼ˆå› å­è¾“å…¥ï¼‰
                          â”‚
    â”Œâ”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”¬â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”
    â–¼               â–¼               â–¼               â–¼              â–¼
NorthNPSFactor   TurnoverFactor  MarginFactor   SentimentFactor   GlobalLeadFactor
    â”‚               â”‚               â”‚              â”‚               â”‚
    â””â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”´â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”€â”˜
                          â”‚
                          â–¼
               FactorResult (V11.7 ç»“æ„åŒ–)
                          â”‚
                          â–¼
                UnifiedScoreBuilder
                          â”‚
                          â–¼
                 PredictionEngine
                (T+1 / T+5 æ–¹å‘é¢„æµ‹)
                          â”‚
                          â–¼
                    ReportBuilder
                          â”‚
                          â–¼
                å®Œæ•´æ—¥æŠ¥ TXTï¼ˆåŒ…å«å› å­ + æƒ…ç»ª + é¢„æµ‹ï¼‰

1. Snapshot å±‚ï¼ˆFetcherï¼‰

Snapshot å¿…é¡»åŒ…å«ï¼š

snapshot = {
  "meta": {...},
  "etf_proxy": {...},
  "turnover": {...},
  "breadth": {...},
  "margin": {...},
  "index_series": {...},
  "global_lead": {...}
}


æ‰€æœ‰å› å­å¿…é¡»åŸºäº snapshotï¼Œä¸å…è®¸è‡ªè¡Œè¯·æ±‚ç½‘ç»œã€‚

2. processedï¼ˆå› å­ç»Ÿä¸€è¾“å…¥ç»“æ„ï¼‰

processed = snapshot å¢å¼ºç‰ˆï¼š

processed = {
  "etf_proxy": {...},
  "turnover": {...},
  "breadth": {...},
  "margin": {...},
  "global_lead": {...},
  "index_series": {...},
  "features": {...},     # æ•°å­—åŒ–ç‰¹å¾é›†åˆ
  "raw": snapshot
}

3. Factor å±‚

æ‰€æœ‰å› å­å¿…é¡»è¿”å›ï¼š

FactorResult(
    name,
    score,
    details={
        "level": "...",
        "raw_fields": ...
        ...
    },
    level="...",
    signal="...",
    raw={...},
    report_block="..."
)


å› å­ä¸å¾—åšç½‘ç»œè¯·æ±‚
å¿…é¡»ä½¿ç”¨ processed ä¸­çš„å­—æ®µã€‚

4. UnifiedScore å±‚

ç»Ÿä¸€åˆ†æ•° = å¤šå› å­åˆ†æ•°çš„åŠ æƒæ±‡æ€»ã€‚

summary = {
  "total_score": float,
  "risk_level": "å¼º/ä¸­æ€§/å¼±",
  "factor_scores": {...}
}

5. Prediction å±‚ï¼ˆT+1/T+5ï¼‰

è¾“å…¥ï¼š

{
  "north_nps": 62.5,
  "turnover": 70.0,
  "margin": 45.0,
  "sentiment": 58.0,
  "global_lead": 67.0
}


è¾“å‡ºï¼š

T+1: {
   "score": 61.2,
   "direction": "åå¤š"
}
T+5: {
   "score": 53.4,
   "direction": "éœ‡è¡åå¼º"
}

6. Report å±‚ï¼ˆæ—¥æŠ¥ï¼‰

åŒ…å«ï¼š

Meta ä¿¡æ¯

å„å› å­åˆ†æ•°

æƒ…ç»ªéƒ¨åˆ†

é¢„æµ‹ç»“æœ

åˆ†éš”çº¿ç»“æ„åŒ–æ’ç‰ˆ